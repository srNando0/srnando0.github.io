(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8520:function(e,t,r){Promise.resolve().then(r.bind(r,9661))},9661:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var i=r(7437),o=r(9039),n=r(2265);let a=async e=>{let t=await fetch(e);return await t.text()};class s extends Error{constructor(e){super(e),this.name="NullError"}}class u extends Error{constructor(e){super(e),this.name="WebGLCompilationError"}}class h extends Error{constructor(e){super(e),this.name="WebGLLinkError"}}class l{createShader(e,t){var r;let i=this.gl.createShader(e);if(!i)throw new s("Couldn't create shader");if(this.gl.shaderSource(i,t),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))return i;let o=null!==(r=this.gl.getShaderInfoLog(i))&&void 0!==r?r:"No shader info log available";throw this.gl.deleteShader(i),new u(o)}createProgram(e){var t;let r=this.gl.createProgram();if(!r)throw new s("Couldn't create program");for(let t of e)this.gl.attachShader(r,t);if(this.gl.linkProgram(r),this.gl.getProgramParameter(r,this.gl.LINK_STATUS))return r;let i=null!==(t=this.gl.getProgramInfoLog(r))&&void 0!==t?t:"No program info log available";throw this.gl.deleteProgram(r),new h(i)}createCamera(e,t){let r=Math.sin(t),i=Math.cos(t),o=Math.sin(e),n=Math.cos(e),a={x:-o,y:n,z:0},s={x:-i*n,y:-i*o,z:r},u={x:r*n,y:r*o,z:i};return[a.x,a.y,a.z,s.x,s.y,s.z,u.x,u.y,u.z]}config(e){let t=this.gl,r=t.createBuffer();if(!r)throw new s("Couldn't create the position buffer");t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),t.STATIC_DRAW);let i=t.getAttribLocation(this.program,"pos");t.bindVertexArray(this.vao),t.enableVertexAttribArray(i);let o={size:2,type:t.FLOAT,normalize:!1,stride:0,offset:0};t.vertexAttribPointer(i,o.size,o.type,o.normalize,o.stride,o.offset),t.bindTexture(t.TEXTURE_2D,this.texture0),t.texStorage2D(t.TEXTURE_2D,1,t.RGBA8,e.x,e.y),t.bindTexture(t.TEXTURE_2D,this.texture1),t.texStorage2D(t.TEXTURE_2D,1,t.RGBA8,e.x,e.y),t.bindVertexArray(this.vao),t.useProgram(this.program),t.uniform2f(this.uResolution,e.x,e.y)}draw(e){let t=this.gl,r={primitiveType:t.TRIANGLE_STRIP,offset:0,count:4},i=Math.tan(Math.PI/360*e.fov),o=this.createCamera(e.mouse.x,e.mouse.y);t.useProgram(this.program),t.uniform1f(this.uFovTangent,i),t.uniform3f(this.uCameraPosition,e.position.x+e.distance*o[6],e.position.y+e.distance*o[7],e.position.z+e.distance*o[8]),t.uniformMatrix3fv(this.uViewMatrix,!1,o),t.uniform1ui(this.uTime,e.time),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),0==this.currentTexture?(t.bindTexture(t.TEXTURE_2D,this.texture0),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture1,0),this.currentTexture=1):(t.bindTexture(t.TEXTURE_2D,this.texture1),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture0,0),this.currentTexture=0),t.drawArrays(r.primitiveType,r.offset,r.count),t.bindFramebuffer(t.FRAMEBUFFER,null),t.useProgram(this.postProgram),0==this.currentTexture?t.bindTexture(t.TEXTURE_2D,this.texture0):t.bindTexture(t.TEXTURE_2D,this.texture1),t.drawArrays(r.primitiveType,r.offset,r.count)}constructor(e,t,r,i){let o=e.getContext("webgl2");if(o)this.gl=o;else throw new s("WebGL2 is not supported");this.vertexShader=this.createShader(o.VERTEX_SHADER,t),this.fragmentShader=this.createShader(o.FRAGMENT_SHADER,r),this.postFragmentShader=this.createShader(o.FRAGMENT_SHADER,i),this.program=this.createProgram([this.vertexShader,this.fragmentShader]),this.postProgram=this.createProgram([this.vertexShader,this.postFragmentShader]);let n=o.createVertexArray();if(!n)throw new s("Couldn't create VAO");this.vao=n,this.currentTexture=0;let a=o.createTexture(),u=o.createTexture(),h=o.createFramebuffer();if(!a)throw new s("Couldn't create texture0");if(!u)throw new s("Couldn't create texture1");if(!h)throw new s("Couldn't create fbo");this.texture0=a,this.texture1=u,this.fbo=h;let l=o.getUniformLocation(this.program,"uResolution"),f=o.getUniformLocation(this.program,"uFovTangent"),m=o.getUniformLocation(this.program,"uCameraPosition"),c=o.getUniformLocation(this.program,"uViewMatrix"),d=o.getUniformLocation(this.program,"uTime");if(!l)throw new s("Couldn't find uResolution uniform");if(!f)throw new s("Couldn't find uFovTangent uniform");if(!m)throw new s("Couldn't find uCameraPosition uniform");if(!c)throw new s("Couldn't find uViewMatrix uniform");if(!d)throw new s("Couldn't find uMTime uniform");this.uResolution=l,this.uFovTangent=f,this.uCameraPosition=m,this.uViewMatrix=c,this.uTime=d,this.config({x:e.width,y:e.height})}}var f=()=>{var e,t,r;let u;let h=(0,n.useRef)(null),f={x:384,y:216},m=(0,o.ZP)("/path-tracer/shaders/vertex.glsl",a),c=(0,o.ZP)("/path-tracer/shaders/fragment.glsl",a),d=(0,o.ZP)("/path-tracer/shaders/post-fragment.glsl",a),g=null!==(e=m.data)&&void 0!==e?e:null,x=null!==(t=c.data)&&void 0!==t?t:null,T=null!==(r=d.data)&&void 0!==r?r:null,w={x:0,y:0},E={x:0,y:Math.PI/2},p=0,R={x:100,y:100};function y(){if(!u)throw new s("pathTracer is null");let e={mouse:E,position:{x:0,y:0,z:2},distance:3,fov:75,time:p};u.draw(e),p+=1,window.requestAnimationFrame(y)}function v(e){let t={x:e.clientX-w.x,y:e.clientY-w.y};w={x:e.clientX,y:e.clientY},1==e.buttons&&(E.x-=t.x/R.x,E.y-=t.y/R.y,E.x%=2*Math.PI,E.y=Math.max(0,Math.min(E.y,Math.PI)),p=0)}return(0,n.useEffect)(()=>{if(null==g||null==x||null==T||null==h.current)return;let e=h.current;e.width=f.x,e.height=f.y;try{return u=new l(e,g,x,T),e.addEventListener("mousemove",v),window.requestAnimationFrame(y),()=>{e.removeEventListener("mousemove",v)}}catch(e){e instanceof Error&&(console.error(e.name),console.log(e.message))}},[h.current,g,x,T]),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:"p-2 rounded-xl flex justify-center",children:(0,i.jsx)("canvas",{ref:h,className:"w-5/6",style:{imageRendering:"pixelated"}})})})}}},function(e){e.O(0,[39,971,23,744],function(){return e(e.s=8520)}),_N_E=e.O()}]);
