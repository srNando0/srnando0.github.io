<!DOCTYPE html>
<head>
	<meta charset = "UTF-8">
</head>
<body>
	
	<div id="vpl_results_accordion" class="ui-accordion ui-widget ui-helper-reset" role="tablist"><h4 class="vpl_ide_accordion_t_grade ui-accordion-header ui-corner-top ui-accordion-header-collapsed ui-corner-all ui-state-default ui-accordion-icons" role="tab" id="ui-id-57" aria-controls="ui-id-29" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Nota proposta: 0 / 100</h4><div class="vpl_ide_accordion_c_grade ui-accordion-content ui-corner-bottom ui-helper-reset ui-widget-content" style="display: none; height: 51.9671px; overflow: auto;" id="ui-id-29" aria-labelledby="ui-id-57" role="tabpanel" aria-hidden="true"></div><div class="vpl_ide_accordion_t_variables"></div><div class="vpl_ide_accordion_c_variables"></div><div class="vpl_ide_accordion_t_compilation"></div><div class="vpl_ide_accordion_c_compilation"></div><h4 class="vpl_ide_accordion_t_comments ui-accordion-header ui-corner-top ui-state-default ui-accordion-header-active ui-state-active ui-accordion-icons" role="tab" id="ui-id-58" aria-controls="ui-id-59" aria-selected="true" aria-expanded="true" tabindex="0"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-s"></span>Comentários</h4><div class="ui-widget vpl_ide_accordion_c_comments ui-accordion-content ui-corner-bottom ui-helper-reset ui-widget-content ui-accordion-content-active" style="overflow: auto;" id="ui-id-59" aria-labelledby="ui-id-58" role="tabpanel" aria-hidden="false"><b class="ui-widget-header ui-corner-all">Failed tests</b><br><div>Test 1: #1 Declaração de variáveis<br>Test 2: #2 Atribuição e contas<br>Test 3: #3 if sem else<br>Test 4: #4 if com else<br>Test 5: #5 Objetos e arrays<br>Test 6: #6 while<br>Test 7: #7 for<br>Test 8: #8 multiplicação de matrizes<br>Test 9: #9 Variável não declarada<br>Test 10: #10 Declaração duplicada da mesma variável<br></div><b class="ui-widget-header ui-corner-all">Test 1: #1 Declaração de variáveis </b><br><div>Incorrect program output<br> --- Input ---<br><pre><i>let a = {}, b = [], c = 9
		let __9 = 1.1; let _ = "abc"
		
		
		</i></pre><br> --- Expected output (exact text)---<br><pre><i>=== Console ===
		=== Vars ===
		|{ _: abc; __9: 1.1; a: { }; b: [ ]; c: 9; }|
		=== Pilha ===
		</i></pre><br></div><b class="ui-widget-header ui-corner-all">Test 2: #2 Atribuição e contas </b><br><div>Incorrect program output<br> --- Input ---<br><pre><i>let a = 1, b, x
		x = b = a * (8 + 1.1)
		let c = "hello ";
		c += ", " + 'world' + '!';
		
		
		</i></pre><br> --- Expected output (text)---<br><pre><i>=== Console ===
		=== Vars ===
		|{ a: 1; b: 9.1; c: hello , world!; x: 9.1; }|
		=== Pilha ===
		"
		</i></pre><br></div><b class="ui-widget-header ui-corner-all">Test 3: #3 if sem else </b><br><div>Incorrect program output<br> --- Input ---<br><pre><i>let a = 4, b = 5, c, d;
		if( a++ &gt; b )
		  c = "a e' maior"
			  + "!"
		if( a &lt; b + 1 )
		  d = "a e' menor";
		
		
		</i></pre><br> --- Expected output (exact text)---<br><pre><i>=== Console ===
		=== Vars ===
		|{ a: 5; b: 5; c: undefined; d: a e' menor; }|
		=== Pilha ===
		</i></pre><br></div><b class="ui-widget-header ui-corner-all">Test 4: #4 if com else </b><br><div>Incorrect program output<br> --- Input ---<br><pre><i>let a = "ABA", c = 'CATE', resultado;
		if( a == c )
		  resultado = "Ta' errado!"
		else if( a &lt; c )
		{
		  resultado = "a vem antes de c: "
		  resultado += a + '&lt;' + c
		}
		else
		  resultado = "Deu ruim!";
		
		</i></pre><br> --- Expected output (exact text)---<br><pre><i>=== Console ===
		=== Vars ===
		|{ a: ABA; c: CATE; resultado: a vem antes de c: ABA&lt;CATE; }|
		=== Pilha ===
		</i></pre><br></div><b class="ui-widget-header ui-corner-all">Test 5: #5 Objetos e arrays </b><br><div>Incorrect program output<br> --- Input ---<br><pre><i>let obj = {}, i = -2
		obj.nome = "Manoel";
		obj.nums = []
		obj.nums[0]
		= 12
		obj.nums[3] = 12
		obj.nums[3] += 1
		obj.nums[i++ + 3] = 45;
		obj['nom' + 'e'] = obj.nome + "!";
		
		</i></pre><br> --- Expected output (exact text)---<br><pre><i>=== Console ===
		=== Vars ===
		|{ i: -1; obj: { nome: Manoel!; nums: [ 0: 12; 1: 45; 2: undefined; 3: 13; ]; }; }|
		=== Pilha ===
		</i></pre><br></div><b class="ui-widget-header ui-corner-all">Test 6: #6 while </b><br><div>Incorrect program output<br> --- Input ---<br><pre><i>let i = 0, j = -1, x = 9, b = []
		while( i &lt; x - 2*3 + 2.1 ) {
		  b[i] = j;
		  i = i + 1
		  j = i / 2.0 + j
		}
		j = x = 0;
		
		</i></pre><br> --- Expected output (exact text)---<br><pre><i>=== Console ===
		=== Vars ===
		|{ b: [ 0: -1; 1: -0.5; 2: 0.5; 3: 2; 4: 4; 5: 6.5; ]; i: 6; j: 0; x: 0; }|
		=== Pilha ===
		</i></pre><br></div><b class="ui-widget-header ui-corner-all">Test 7: #7 for </b><br><div>Incorrect program output<br> --- Input ---<br><pre><i>let a = {}, campo = "c"
		for( let i = 0; i &lt; 6; i = i + 2 ) {
		  a[campo = campo + i] = i;
		}
		
		</i></pre><br> --- Expected output (exact text)---<br><pre><i>=== Console ===
		=== Vars ===
		|{ a: { c0: 0; c02: 2; c024: 4; }; campo: c024; i: 6; }|
		=== Pilha ===
		</i></pre><br></div><b class="ui-widget-header ui-corner-all">Test 8: #8 multiplicação de matrizes </b><br><div>Incorrect program output<br> --- Input ---<br><pre><i>let a = [], b = [], c = [];
		let i, j, k;
		for( i = 0; i &lt; 4; i = i + 1 ) {
		  a[i] = [];
		  b[i] = [];
		  for( j = 0; j &lt; 4; j += 1 ) {
			a[i][j] = b[i][j] = 1.1/(i+j+1.0)
		  }
		}
		
		for( i = 0; i &lt; 4; i = i + 1 ) {
		  c[i] = [];
		  for( j = 0; j &lt; 4; j = j + 1 ) {
			c[i][j] = 0
			for( k = 0; k &lt; 4; k = k + 1 ) {
			  c[i][j] = c[i][j] + a[i][k] * b[k][j];
			}
		  }
		}
		
		</i></pre><br> --- Expected output (exact text)---<br><pre><i>=== Console ===
		=== Vars ===
		|{ a: [ 0: [ 0: 1.1; 1: 0.55; 2: 0.366667; 3: 0.275; ]; 1: [ 0: 0.55; 1: 0.366667; 2: 0.275; 3: 0.22; ]; 2: [ 0: 0.366667; 1: 0.275; 2: 0.22; 3: 0.183333; ]; 3: [ 0: 0.275; 1: 0.22; 2: 0.183333; 3: 0.157143; ]; ]; b: [ 0: [ 0: 1.1; 1: 0.55; 2: 0.366667; 3: 0.275; ]; 1: [ 0: 0.55; 1: 0.366667; 2: 0.275; 3: 0.22; ]; 2: [ 0: 0.366667; 1: 0.275; 2: 0.22; 3: 0.183333; ]; 3: [ 0: 0.275; 1: 0.22; 2: 0.183333; 3: 0.157143; ]; ]; c: [ 0: [ 0: 1.72257; 1: 0.968; 2: 0.685667; 3: 0.533937; ]; 1: [ 0: 0.968; 1: 0.560969; 2: 0.403333; 3: 0.316905; ]; 2: [ 0: 0.685667; 1: 0.403333; 2: 0.292081; 3: 0.230476; ]; 3: [ 0: 0.533937; 1: 0.316905; 2: 0.230476; 3: 0.18233; ]; ]; i: 4; j: 4; k: 4; }|
		=== Pilha ===
		</i></pre><br></div><b class="ui-widget-header ui-corner-all">Test 9: #9 Variável não declarada </b><br><div>Incorrect program output<br> --- Input ---<br><pre><i>let a = 1, x = '9'
		b = 10;
		
		</i></pre><br> --- Expected output (exact text)---<br><pre><i>Erro: a variável 'b' não foi declarada.
		=== Console ===
		=== Vars ===
		|{ }|
		=== Pilha ===
		</i></pre><br></div><b class="ui-widget-header ui-corner-all">Test 10: #10 Declaração duplicada da mesma variável </b><br><div>Incorrect program output<br> --- Input ---<br><pre><i>let a = {}, b = [], c = 9
		let a;
		
		</i></pre><br> --- Expected output (exact text)---<br><pre><i>Erro: a variável 'a' já foi declarada na linha 1.
		=== Console ===
		=== Vars ===
		|{ }|
		=== Pilha ===
		</i></pre><br></div><b class="ui-widget-header ui-corner-all">Summary of tests</b><br><div><pre><i>+------------------------------+
		| 10 tests run/ 0 tests passed |
		+------------------------------+
		</i></pre><br><br></div></div><div class="vpl_ide_accordion_t_execution"></div><div class="vpl_ide_accordion_c_execution"></div><h4 class="vpl_ide_accordion_t_description ui-accordion-header ui-corner-top ui-state-default ui-accordion-header-collapsed ui-corner-all ui-accordion-icons" role="tab" id="ui-id-18" aria-controls="ui-id-19" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Descrição</h4><div class="ui-widget vpl_ide_accordion_c_description ui-accordion-content ui-corner-bottom ui-helper-reset ui-widget-content" style="height: 52.9671px; overflow: auto; display: none;" id="ui-id-19" aria-labelledby="ui-id-18" role="tabpanel" aria-hidden="true"><div class="no-overflow"><h5><br></h5>
		<h5>Compilador de mini Javascript</h5>
		<p>Iremos construir um compilador de Javascript para uma forma intermediária de um máquina de pilha, em várias etapas. Em cada etapa algumas funcionalidades serão acrescentadas sobre o que já foi feito, logo uma das características desejáveis do programa
			é ser manutenível (ser de fácil manutenção e ter boa legibilidade).&nbsp;</p>
		<p>Inicialmente teremos variáveis sem tipo definido, mas com os qualificadores adequados: <i><strong>let</strong></i>, <i><strong>const</strong></i> e o <i><strong>var</strong></i>. O escopo pode ser global (fora de todos os blocos) ou local a um bloco.
			A principal diferença nesse momento é que todos os comandos devem ser separados por ';' ou '\n'. Ficam de fora nessa primeira etapa também <strong>funções</strong> e expressões lambda (arrow functions e funções anônimas).<br></p>
		<p>Construções a serem implementadas:</p>
		<p></p>
		<ol>
			<li><strong>let</strong>, <strong>const</strong> e <strong>var</strong> (as variáveis em javascript podem receber valores de qualquer tipo): &nbsp;</li>
			<ul>
				<li><span style="font-size: calc(0.90375rem + 0.045vw);">uma variável do tipo </span><strong style="font-size: calc(0.90375rem + 0.045vw);">let</strong><span style="font-size: calc(0.90375rem + 0.045vw);"> só pode ser declarada uma única vez em cada escopo;</span></li>
				<li><span style="font-size: calc(0.90375rem + 0.045vw);">uma variável declarada com <strong>var</strong> pode ser declarada diversas vezes, desde que não tenha sido declarada com <strong>let</strong> ainda;</span></li>
				<li><span style="font-size: calc(0.90375rem + 0.045vw);">se uma variável for declarada com <strong>let</strong> ela não pode ser declarada de novo com <strong>var</strong>;</span></li>
				<li><span style="font-size: calc(0.90375rem + 0.045vw);">se uma variável for declarada com <strong>var</strong> ela não pode ser declarada de novo com <strong>let</strong>;</span></li>
				<li><span style="font-size: calc(0.90375rem + 0.045vw);"><strong>const</strong> segue as mesmas regras do <strong>let</strong>, acrescentando a restrição de que o valor da variável não pode ser alterado (mas seus campos podem)<strong>.</strong></span></li>
			</ul>
			<li>Comandos estruturados: <strong>if</strong>, <strong>while</strong>,<strong>&nbsp;for</strong>. Ficam de fora <strong>do-while</strong>, <strong>switch-case-break</strong>,&nbsp;<strong>return</strong>,&nbsp;<strong>continue</strong>,&nbsp;<strong>labels</strong>        e "forEach" (<strong>for</strong> específicos para arrays,<strong> for in</strong> etc).</li>
		</ol>
		<p>A nossa máquina de pilha será alterada para poder executar as seguintes instruções:</p>
		<p></p>
		<table cellspacing="0" border="2">
			<colgroup "=" " width="58 "></colgroup>
			<colgroup width="133 "></colgroup>
			<colgroup width="85 "></colgroup>
			<colgroup width="426 "></colgroup>
			<tbody><tr>
				<td colspan="4 " valign="middle " height="17 " align="center "><strong>Instruções</strong></td>
				</tr>
			<tr>
				<td valign="middle " height="17 " align="center "><strong>Código</strong></td>
				<td valign="middle " align="center "><strong>Nome</strong></td>
				<td valign="middle " align="center "><strong>Parâmetros</strong></td>
				<td valign="middle " align="left "><strong>Descrição</strong></td>
			</tr>
			<tr>
				<td valign="middle " height="32 " align="center "># </td>
				<td valign="middle " align="center "> goto </td>
				<td sdval="1 " sdnum="1046; " valign="middle " align="center ">1</td>
				<td valign="middle " align="left ">Desvia para o endereço no topo da pilha (ou chama uma função primitiva)</td>
			</tr>
			<tr>
				<td valign="middle " height="17 " align="center ">{} </td>
				<td valign="middle " align="center "> newObject </td>
				<td sdval="0 " sdnum="1046; " valign="middle " align="center ">0</td>
				<td valign="middle " align="left "> novo objeto</td>
			</tr>
			<tr>
				<td valign="middle " height="17 " align="center ">[] </td>
				<td valign="middle " align="center "> newArray </td>
				<td sdval="0 " sdnum="1046; " valign="middle " align="center ">0</td>
				<td valign="middle " align="left "> novo array</td>
			</tr>
			<tr>
				<td valign="middle " height="17 " align="center ">@ </td>
				<td valign="middle " align="center "> get </td>
				<td sdval="1 " sdnum="1046; " valign="middle " align="center ">1</td>
				<td valign="middle " align="left "> busca o valor da variável na pilha de RA’s, até encontrar ou dar erro</td>
			</tr>
			<tr>
				<td valign="middle " height="17 " align="center ">=</td>
				<td valign="middle " align="center "> set </td>
				<td sdval="1 " sdnum="1046; " valign="middle " align="center ">2</td>
				<td valign="middle " align="left ">Armazena o valor no topo da pilha em uma variável (se não existe local, busca global). Empilha esse valor de novo para permitir múltiplas atribuições: a = b = 8</td>
			</tr>
			<tr>
				<td valign="middle " height="17 " align="center ">? </td>
				<td valign="middle " align="center "> jumpTrue </td>
				<td sdval="2 " sdnum="1046; " valign="middle " align="center ">2</td>
				<td valign="middle " align="left "> Testa e desvia para o endereço no topo da pilha</td>
			</tr>
			<tr>
				<td valign="middle " height="17 " align="center ">&amp; </td>
				<td valign="middle " align="center "> let </td>
				<td sdval="1 " sdnum="1046; " valign="middle " align="center ">1</td>
				<td valign="middle " align="left "> declara uma variável (no escopo atual)</td>
			</tr>
			<tr>
				<td valign="middle " height="17 " align="center ">[@] </td>
				<td valign="middle " align="center "> getProp </td>
				<td sdval="2 " sdnum="1046; " valign="middle " align="center ">2</td>
				<td valign="middle " align="left "> Lê a propriedade no topo da pilha de um objeto ou array</td>
			</tr>
			<tr>
				<td valign="middle " height="32 " align="center ">[=] </td>
				<td valign="middle " align="center "> setProp </td>
				<td valign="middle " align="center ">3 (o,p,v)</td>
				<td valign="middle " align="left ">atribui um valor à uma propriedade de um objeto: o[p] = v <br>(array ou objeto).&nbsp;Empilha esse valor de novo para permitir múltiplas atribuições: a.c = b.c = 8</td>
			</tr>
			<tr>
				<td valign="middle " height="32 " align="center ">$ </td>
				<td valign="middle " align="center "> callFunc </td>
				<td valign="middle " align="center ">2 (n,f)</td>
				<td valign="middle " align="left ">empilha um novo RA e desvia para f. N é o número de parâmetros (os parâmetros da função devem estar empilhados). </td>
			</tr>
			<tr>
				<td valign="middle " height="17 " align="center ">~ </td>
				<td valign="middle " align="center "> retFunc </td>
				<td sdval="1 " sdnum="1046; " valign="middle " align="center ">1</td>
				<td valign="middle " align="left "> desempilha o RA e desvia para o endereço no topo da pilha</td>
			</tr>
			<tr>
				<td valign="middle " height="17 " align="center ">^ </td>
				<td valign="middle " align="center "> pop </td>
				<td sdval="0 " sdnum="1046; " valign="middle " align="center ">0</td>
				<td valign="middle " align="left "> desempilha um parâmetro na pilha de operandos</td>
			</tr>
			<tr>
				<td valign="middle " height="17 " align="center ">.</td>
				<td align="center ">halt</td>
				<td sdval="0 " sdnum="1046; " valign="middle " align="center ">0</td>
				<td valign="middle " align="left
				"> termina a execução</td>
			</tr>
		</tbody></table><br><p></p>Cada instrução ocupa um endereço, independente do tamanho de sua string. Ou seja, considere que teremos um array de código onde cada <i><strong>token</strong></i> é uma posição. O array de instruções começa em zero. É permitido armazenar endereços em variáveis, pois pode considerá-los como números inteiros.<p>É importante notar que a instrução "<strong>retFunc</strong>" apenas irá desempilhar o Registro de Ativação e desviará para o endereço no topo da pilha, logo é necessário passar para a função o endereço de retorno, que deve ser empilhado. Isso será detalhado na próxima aula, no tópico Registro
				de Ativação.
				<br></p>
				<h5>Exemplos:</h5>
				<p><strong>Entrada:</strong></p>
				<pre style="text-align: left; background-color:#DDD; border-radius: 5px; padding: 10px; border: 1px solid rgba(0,0,0,.45)">let a = {};<br>let b = [];<br>let c, d;<br>c = 1;<br>d = 'Hello';<br>a.campo = c + 1;<br>b[9] = a.campo;<br></pre>
				<p><strong>Saída:</strong></p>
				<pre style="text-align: left; background-color:#DDD; border-radius: 5px; padding: 10px; border: 1px solid rgba(0,0,0,.45)">a&amp; a {} = ^<br>b&amp; b [] = ^<br>c&amp; d&amp;<br>c 1 = ^<br>d 'Hello' = ^<br>a@ campo c@ 1 + [=] ^<br>b@ 9 a@ campo[@] [=] ^<br>.<br></pre>
				<p>Espaços, tabulação e quebra de linha serão ignorados sempre que for possível diferenciar uma instrução da seguinte.</p>
				<p></p>
				<p>Sugestão inicial de gramática: será necessário um símbolo não terminal para tratar <span><strong style="font-style: italic;">lvalues</strong><span> e </span><i><strong>rvalues</strong>. </i>Note que todo <strong><i>lvalue</i></strong>            pode ser um <strong><i>rvalue</i></strong>, mas apenas algumas construções podem ser <strong><i>lvalues</i></strong>. são elas:</span>
				</p>
				<pre style="text-align: left; background-color:#DDD; border-radius: 5px; padding: 10px; border: 1px solid rgba(0,0,0,.45)"><span>LVALUE <span>-&gt;</span> id<br></span><span>LVALUEPROP&nbsp;-&gt; E [ E ]<br></span><span>LVALUEPROP&nbsp;-&gt; E . id</span></pre>
				<p><span></span></p>
				<p><span>Apenas devemos diferencias <i><strong>setProp</strong></i> "[=]" de atribuição "=".&nbsp;</span></p>
				<p><span>As atribuições devem ser tratadas na produção do operador '<strong>=</strong>' (que é associativo à direita).&nbsp;Já as operações de leitura "<strong>@</strong>" e "<strong>[@]</strong>" devem ser tratadas na conversão de E em <strong><span><i>lvalue</i></span></strong>.</span>
				</p>
				<pre style="text-align: left; background-color:#DDD; border-radius: 5px; padding: 10px; border: 1px solid rgba(0,0,0,.45)"><span><br></span>E -&gt; LVALUE <strong>=</strong> E <span style="white-space:pre">	</span>&nbsp; &nbsp;&nbsp;<br>&nbsp; | LVALUEPROP <strong>=</strong> E <span style="white-space:pre">	<br></span>&nbsp; | ...<br>  | LVALUE<br>  | LVALUEPROP</pre>
				<p>Dessa forma, um <span><i><strong>lvalue </strong></i></span>pode ser convertido em um <i><strong>rvalue </strong></i>(símbolo E).</p>
				<h5>Tratamento de erros</h5>
				<p>Não serão testados erros de sintaxe. Porém, compilador deve tratar três tipos de erros:&nbsp;</p>
				<p></p>
				<ul>
					<li>Quando uma variável for declarada em duplicidade deve encerrar a compilação com a mensagem:&nbsp;</li>
				</ul>
				<div class="editor-indent" style="margin-left: 30px;">
					<pre style="text-align: left; background-color:#DDD; border-radius: 5px; padding: 10px; border: 1px solid rgba(0,0,0,.45)"><i>Erro: a variável 'xxx' já foi declarada na linha nn.</i></pre>
				</div>
				<ul>
					<li>Quando uma variável for utilizada sem ter sido declarada deve encerrar a compilação com a mensagem:&nbsp;</li>
				</ul>
				<div class="editor-indent" style="margin-left: 30px;">
					<pre style="text-align: left; background-color:#DDD; border-radius: 5px; padding: 10px; border: 1px solid rgba(0,0,0,.45)"><i>Erro: a variável 'xxx' não foi declarada.</i></pre>
				</div>
				<ul>
					<li>Quando uma variável <strong>const</strong> for modificada deve encerrar a compilação com a mensagem:</li>
				</ul>
				<div class="editor-indent" style="margin-left: 30px;">
					<pre style="text-align: left; background-color:#DDD; border-radius: 5px; padding: 10px; border: 1px solid rgba(0,0,0,.45)"><i>Erro: tentativa de modificar uma variável constante ('xxx').</i></pre></div>
				<p></p>
				<p></p>
				<h5><span>Interpretador</span></h5>
				<p><span>Clique <a href="https://moodle.cos.ufrj.br/pluginfile.php/19812/mod_vpl/intro/mdp.zip">aqui</a> para baixar o interpretador da máquina de pilha.</span></p>
				<p></p>
				<p></p>
				<p></p>
				<p></p></div></div></div>
				
</body>
